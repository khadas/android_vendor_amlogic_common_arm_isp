/*
*
* SPDX-License-Identifier: GPL-2.0
*
* Copyright (C) 2020 Amlogic or its affiliates
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation; version 2.
* This program is distributed in the hope that it will be useful, but
* WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
* or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
* for more details.
* You should have received a copy of the GNU General Public License along
* with this program; if not, write to the Free Software Foundation, Inc.,
* 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
*
*/

#ifndef __AML_P1_OV9285_H__
#define __AML_P1_OV9285_H__

#define OV9285_STANDBY 0x0100
#define OV9285_ID 0x9286
#define OV9285_MCLK 24000000
#define OV9285_DEFAULT_LINK_FREQ 800000000

struct ov9285_regval {
	u16 reg;
	u8 val;
};

struct ov9285_mode {
	u32 width;
	u32 height;
	u32 pixel_rate;
	u32 link_freq_index;
	u32 hblank;

	const struct ov9285_regval *data;
	u32 data_size;
};

struct ov9285 {
	struct device *dev;
	struct clk *xclk;
	struct regmap *regmap;

	struct i2c_client *client;
	struct v4l2_subdev sd;
	struct v4l2_fwnode_endpoint ep;
	struct media_pad pad;
	struct v4l2_mbus_framefmt current_format;
	const struct ov9285_mode *current_mode;

	struct gpio_desc *pwr_gpio;
	struct gpio_desc *pwdn_gpio;
	struct gpio_desc *reset_gpio;
	struct regulator *vddcam;
	struct regulator *viocam;

	struct v4l2_ctrl_handler ctrls;
	struct v4l2_ctrl *link_freq;
	struct v4l2_ctrl *pixel_rate;
	struct v4l2_ctrl *hblank;
	struct v4l2_ctrl *fps;
	struct v4l2_ctrl *strobe;
	struct v4l2_ctrl *role;

	int status;
	struct mutex lock;
	bool master;
};

struct ov9285_pixfmt {
	u32 code;
	u32 min_width;
	u32 max_width;
	u32 min_height;
	u32 max_height;
};

static const struct ov9285_regval ov9285_640_400_10bits_800mbps_2lane_30fps_settings[] = {
	{0x0103, 0x01},
	{0x0100, 0x00},
	{0x0300, 0x06},
	{0x0301, 0x01},
	{0x0302, 0x90},
	{0x0303, 0x01},
	{0x030a, 0x01},
	{0x030d, 0x50},
	{0x030f, 0x03},
	{0x0312, 0x07},
	{0x0313, 0x01},
	{0x3004, 0x00},
	{0x3006, 0x06},
	{0x300f, 0xf4},
	{0x3011, 0x0a},
	{0x3013, 0x18},
	{0x302c, 0x00},
	{0x302d, 0x00},
	{0x302e, 0x00},
	{0x302f, 0x05},
	{0x3030, 0x10},
	{0x303f, 0x03},
	{0x31ff, 0x01},
	{0x3210, 0x04},
	{0x3500, 0x00},
	{0x3501, 0xde},
	{0x3502, 0x70},
	{0x3503, 0x08},
	{0x3505, 0x8c},
	{0x3507, 0x03},
	{0x3508, 0x00},
	{0x3509, 0x10},
	{0x3610, 0x80},
	{0x3611, 0xb8},
	{0x3612, 0x02},
	{0x3614, 0x80},
	{0x3620, 0x6e},
	{0x3632, 0x56},
	{0x3633, 0x78},
	{0x3662, 0x15},
	{0x3666, 0x70},
	{0x3670, 0x68},
	{0x367e, 0x90},
	{0x3680, 0x84},
	{0x3707, 0x6c},
	{0x3712, 0x80},
	{0x372d, 0x22},
	{0x3731, 0x90},
	{0x3732, 0x30},
	{0x3778, 0x10},
	{0x377d, 0x22},
	{0x3788, 0x02},
	{0x3789, 0xa4},
	{0x378a, 0x00},
	{0x378b, 0x44},
	{0x3799, 0x20},
	{0x379b, 0x01},
	{0x379c, 0x10},
	{0x37a8, 0x42},
	{0x37aa, 0x52},
	{0x37ab, 0x3c},
	{0x3800, 0x00},
	{0x3801, 0x00},
	{0x3802, 0x00},
	{0x3803, 0x70},
	{0x3804, 0x05},
	{0x3805, 0x3f},
	{0x3806, 0x03},
	{0x3807, 0xff},
	{0x3808, 0x02},
	{0x3809, 0x80},
	{0x380a, 0x01},
	{0x380b, 0x90},
	{0x380c, 0x02},
	{0x380d, 0xe8},
	{0x380e, 0x0e},
	{0x380f, 0x00},
	{0x3810, 0x00},
	{0x3811, 0x10},
	{0x3812, 0x00},
	{0x3813, 0x08},
	{0x3814, 0x22},
	{0x3815, 0x22},
	{0x3816, 0x00},
	{0x3817, 0x01},
	{0x3818, 0x00},
	{0x3819, 0x05},
	{0x3820, 0x61},
	{0x3821, 0x01},
	{0x382b, 0x3a},
	{0x382c, 0x09},
	{0x382d, 0x9a},
	{0x3880, 0x10},
	{0x3881, 0x42},
	{0x3882, 0x01},
	{0x3883, 0xcc},
	{0x3885, 0x07},
	{0x389d, 0x03},
	{0x38a6, 0x00},
	{0x38a7, 0x01},
	{0x38a8, 0x00},
	{0x38a9, 0xf0},
	{0x38b1, 0x00},
	{0x38b3, 0x07},
	{0x38c4, 0x01},
	{0x38c5, 0x18},
	{0x38c6, 0x02},
	{0x38c7, 0xa8},
	{0x38e5, 0x02},
	{0x38e7, 0x00},
	{0x38e8, 0x00},
	{0x38ed, 0x00},
	{0x38ee, 0x00},
	{0x38ef, 0x00},
	{0x3920, 0xa5},
	{0x3921, 0x00},
	{0x3922, 0x00},
	{0x3923, 0x00},
	{0x3924, 0x05},
	{0x3925, 0x00},
	{0x3926, 0x00},
	{0x3927, 0x00},
	{0x3928, 0x1a},
	{0x3929, 0x01},
	{0x392a, 0xb4},
	{0x392b, 0x00},
	{0x392c, 0x10},
	{0x392f, 0x40},
	{0x393e, 0x00},
	{0x393f, 0x00},
	{0x4001, 0x00},
	{0x4003, 0x10},
	{0x4008, 0x02},
	{0x4009, 0x05},
	{0x400a, 0x01},
	{0x400b, 0x70},
	{0x400c, 0x02},
	{0x400d, 0x05},
	{0x4010, 0xf0},
	{0x4016, 0x00},
	{0x4012, 0x08},
	{0x4017, 0x10},
	{0x4042, 0xd1},
	{0x4043, 0x60},
	{0x4045, 0x20},
	{0x404b, 0x20},
	{0x4507, 0xd0},
	{0x450b, 0xb0},
	{0x450f, 0x00},
	{0x4800, 0x60},
	{0x481f, 0x30},
	{0x4825, 0x35},
	{0x4837, 0x28},
	{0x4f00, 0x00},
	{0x4f07, 0x00},
	{0x4f08, 0x03},
	{0x4f09, 0x08},
	{0x4f0c, 0x02},
	{0x4f0d, 0x64},
	{0x4f10, 0x00},
	{0x4f11, 0x00},
	{0x4f12, 0x0f},
	{0x4f13, 0xc4},
	{0x4f07, 0x00},
	{0x5000, 0x9f},
	{0x5e00, 0x00},
};

static const struct ov9285_regval ov9285_1328_1120_10bits_800mbps_2lane_30fps_settings[] = {
	{0x0103, 0x01},
	{0x0100, 0x00},
	{0x0300, 0x06},
	{0x0301, 0x01},
	{0x0302, 0x90},
	{0x030a, 0x01},
	{0x030d, 0x50},
	{0x030f, 0x03},
	{0x0312, 0x07},
	{0x0313, 0x01},
	{0x3004, 0x00},
	{0x3006, 0x06},
	{0x300f, 0xf4},
	{0x3011, 0x0a},
	{0x3013, 0x18},
	{0x302c, 0x00},
	{0x302d, 0x00},
	{0x302e, 0x00},
	{0x302f, 0x05},
	{0x3030, 0x10},
	{0x303f, 0x03},
	{0x31ff, 0x01},
	{0x3210, 0x04},
	{0x3500, 0x00},
	{0x3501, 0x48},
	{0x3502, 0x00},
	{0x3503, 0x08},
	{0x3505, 0x8c},
	{0x3507, 0x03},
	{0x3508, 0x00},
	{0x3509, 0x10},
	{0x350d, 0x07},
	{0x3510, 0x00},
	{0x3511, 0x00},
	{0x3512, 0x00},
	{0x3610, 0x80},
	{0x3611, 0xb8},
	{0x3612, 0x02},
	{0x3614, 0x80},
	{0x3620, 0x6e},
	{0x3632, 0x56},
	{0x3633, 0x78},
	{0x3662, 0x15},
	{0x3666, 0x70},
	{0x3670, 0x68},
	{0x3678, 0x00},
	{0x367e, 0x90},
	{0x3680, 0x84},
	{0x3707, 0x6c},
	{0x3712, 0x80},
	{0x372d, 0x22},
	{0x3731, 0x90},
	{0x3732, 0x30},
	{0x3778, 0x00},
	{0x377d, 0x22},
	{0x3788, 0x02},
	{0x3789, 0xa4},
	{0x378a, 0x00},
	{0x378b, 0x44},
	{0x3799, 0x20},
	{0x379b, 0x01},
	{0x379c, 0x10},
	{0x37a8, 0x42},
	{0x37aa, 0x52},
	{0x37ab, 0x3c},
	{0x3800, 0x00},
	{0x3801, 0x00},
	{0x3802, 0x00},
	{0x3803, 0x00},
	{0x3804, 0x05},
	{0x3805, 0x3f},
	{0x3806, 0x04},
	{0x3807, 0x6f},
	{0x3808, 0x05},
	{0x3809, 0x30},
	{0x380a, 0x04},
	{0x380b, 0x60},
	{0x380c, 0x02},
	{0x380d, 0xe8},
	{0x380e, 0x0d},
	{0x380f, 0xec},
	{0x3810, 0x00},
	{0x3811, 0x08},
	{0x3812, 0x00},
	{0x3813, 0x08},
	{0x3814, 0x11},
	{0x3815, 0x11},
	{0x3816, 0x00},
	{0x3817, 0x01},
	{0x3818, 0x00},
	{0x3819, 0x05},
	{0x3820, 0x40},
	{0x3821, 0x00},
	{0x382b, 0x3a},
	{0x382c, 0x09},
	{0x382d, 0x9a},
	{0x3880, 0x10},
	{0x3881, 0x42},
	{0x3882, 0x01},
	{0x3883, 0xcc},
	{0x3885, 0x07},
	{0x389d, 0x03},
	{0x38a6, 0x00},
	{0x38a7, 0x01},
	{0x38a8, 0x00},
	{0x38a9, 0xf0},
	{0x38b1, 0x00},
	{0x38b3, 0x07},
	{0x38c4, 0x01},
	{0x38c5, 0x18},
	{0x38c6, 0x02},
	{0x38c7, 0xa8},
	{0x38e5, 0x02},
	{0x38e7, 0x00},
	{0x38e8, 0x00},
	{0x38ed, 0x00},
	{0x38ee, 0x00},
	{0x38ef, 0x00},
	{0x3920, 0xa5},
	{0x3921, 0x00},
	{0x3922, 0x00},
	{0x3923, 0x00},
	{0x3924, 0x05},
	{0x3925, 0x00},
	{0x3926, 0x00},
	{0x3927, 0x00},
	{0x3928, 0x1a},
	{0x3929, 0x01},
	{0x392a, 0xb4},
	{0x392b, 0x00},
	{0x392c, 0x10},
	{0x392f, 0x40},
	{0x393e, 0x00},
	{0x393f, 0x00},
	{0x4001, 0x00},
	{0x4003, 0x40},
	{0x4008, 0x02},
	{0x4009, 0x09},
	{0x400a, 0x01},
	{0x400b, 0x30},
	{0x400c, 0x02},
	{0x400d, 0x09},
	{0x4010, 0xf0},
	{0x4016, 0x00},
	{0x4012, 0x08},
	{0x4017, 0x10},
	{0x4042, 0xd3},
	{0x4043, 0x60},
	{0x4045, 0x20},
	{0x404b, 0x20},
	{0x4507, 0x40},
	{0x450b, 0x80},
	{0x450f, 0x00},
	{0x4800, 0x60},
	{0x481f, 0x30},
	{0x4825, 0x35},
	{0x4837, 0x14},
	{0x4f00, 0x00},
	{0x4f07, 0x00},
	{0x4f08, 0x03},
	{0x4f09, 0x08},
	{0x4f0c, 0x04},
	{0x4f0d, 0xe4},
	{0x4f10, 0x00},
	{0x4f11, 0x00},
	{0x4f12, 0x0f},
	{0x4f13, 0xc4},
	{0x4f07, 0x00},
	{0x5000, 0x9f},
	{0x5e00, 0x00},
	{0x38b1, 0x02},
	{0x3880, 0x00},
	{0x3500, 0x00},
	{0x3501, 0x48},
	{0x3502, 0xb0},
};

static const struct ov9285_regval ov9285_master_settings[] = {
	{0x3006, 0x0E},
	{0x3666, 0x70},
	{0x3823, 0x00},
	{0x3020, 0x20},
	{0x3022, 0x02},
	{0x3817, 0x00},
	{0x382b, 0x5a},
	{0x3920, 0xff},
};

static const struct ov9285_regval ov9285_slave_settings[] = {
	{0x3006, 0x04},
	{0x3666, 0x00},
	{0x38b3, 0x07},
	{0x3885, 0x07},
	{0x382b, 0x3a},
	{0x3670, 0x68},
	{0x3823, 0x30},
	{0x3824, 0x00},
	{0x3825, 0x08},
	{0x3826, 0x00},
	{0x3827, 0x00},
	{0x3740, 0x01},
	{0x3741, 0x00},
	{0x3742, 0x00},
	{0x3817, 0x01},
	{0x382b, 0x3a},
	{0x3920, 0xa5},
};

static int ov9285_set_ctrl(struct v4l2_ctrl *ctrl);

#endif
